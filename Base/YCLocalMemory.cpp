
#include	"stdafx.h"
#include	"YCLocalMemory.h"

//////////////////////////////////////////////////////////////////////////////////////////
//	Constructor

YCLocalMemory::YCLocalMemory()
{
	m_hMemory = NULL;
	m_pvMemory = NULL;
}

//////////////////////////////////////////////////////////////////////////////////////////
//	Destructor

YCLocalMemory::~YCLocalMemory()
{
	// Free memory

	Free();
}

//////////////////////////////////////////////////////////////////////////////////////////
//	Allocation of memory

BOOL	YCLocalMemory::Alloc(
	UINT				uFlags,							// Flag
	UINT				uBytes							// Memory size to ensure
	)
{
	m_hMemory = ::LocalAlloc( uFlags, uBytes );

	if( m_hMemory == NULL )
	{
		throw	std::bad_alloc();
	}

	return	(m_hMemory != NULL);
}

//////////////////////////////////////////////////////////////////////////////////////////
//	Release Memory

BOOL	YCLocalMemory::Free()
{
	Unlock();

	if( m_hMemory != NULL )
	{
		if( ::LocalFree( m_hMemory ) != NULL )
		{
			return	FALSE;
		}

		m_hMemory = NULL;
	}

	return	TRUE;
}

//////////////////////////////////////////////////////////////////////////////////////////
//	Lock Memory

void*	YCLocalMemory::Lock()
{
	m_pvMemory = ::LocalLock( m_hMemory );

	return	m_pvMemory;
}

//////////////////////////////////////////////////////////////////////////////////////////
//	Unlock Memory

BOOL	YCLocalMemory::Unlock()
{
	if( m_pvMemory != NULL )
	{
		while( ::LocalUnlock( m_hMemory ) );
		m_pvMemory = NULL;
	}

	return	TRUE;
}

//////////////////////////////////////////////////////////////////////////////////////////
//	Get Memory Size

UINT	YCLocalMemory::GetSize()
{
	if( m_hMemory == NULL )
	{
		return	0;
	}

	return	::LocalSize( m_hMemory );
}

//////////////////////////////////////////////////////////////////////////////////////////
//	Get Memory Handle

HLOCAL&	YCLocalMemory::GetHandle()
{
	return	m_hMemory;
}

//////////////////////////////////////////////////////////////////////////////////////////
//	Get Memory Pointer

void*	YCLocalMemory::GetPtr()
{
	return	m_pvMemory;
}
